
### PRNG


![prng](https://github.com/Hed6eH0g/ctf/blob/main/2023/tamuctf/prng/prng_0.png)


This challenge asks us to predict the following 10 digits with given 10 digits.
The given sequence is generated by LCG (linear congruent generator) which is defined by $x_{i+1} = ax_i + c \pmod{m}$ for $i \geq 0$.
We have 10 digits ($x_0, x_1, \ldots, x_9$), however, $a, c, m$ are not clear even if we check the code `server.py`.
So, we need to figure them out from linear equality with unknown seed `x_0` as follows:
\displaylines{x_1 = ax_0 + c \pmod{m}, \\\ x_2 = ax_1 + c \pmod{m}, \\\ \vdots, \\\ x_9 = ax_8 + c \pmod{m}, \\\ x_{10} = ax_9 + c \pmod{m}.}


Subtracting the neighbors allows us to reduce the common unknown value `c` in the above equations, we have 
```math
y_1 = x_2 - x_1 = a(x_1 - x_0) \pmod{m},
y_2 = x_3 - x_2 = a(x_2 - x_1) = ay_1 \pmod{m},
y_3 = x_4 - x_3= a(x_3 - x_2) = a^2y_1 \pmod{m},
y_4 = x_5 - x_4 = a(x_4 - x_3) = a^3y_1 \pmod{m},
\vdots,
y_{10} = x_{10} - x_9 = a(x_9 - x_8) = a^9y_1 \pmod{m}.
```

They induce the fact that $y_1y_4 = y_2y_3$ and is congruent to $y_1y_4 - y_2y_3 = k_1m$ for some positive integer $k_1$.
In the same manner, we can prepare the following equalities and extract $m$ as the GCD of them.
```math
y_1y_4 - y_2y_3 = k_1m,
y_2y_5 - y_3y_4 = k_2m,
\vdots,
y_7y_10 - y_8y_9 = k_7m.
```
Then, we can compute `a` by `a = y_2/y_1 \pmod{m}` and find `c = x_2 - ax_1 \pmod{m}`.
Therefore, the following 10 digits are obtained as follows.
```
import math
import libnum
from pwn import *
import functools
import math


io = remote("tamuctf.com", 443, ssl=True, sni="prng")
# p.interactive()
context.log_level = 'debug'
resp = io.recvline()
print(resp.decode(),end='')

seq = []
for i in range(10):
  resp = io.recvline()
  si = int(resp.decode().replace('\n',''))
  seq.append(si)
  print(si)


y = [seq[i+1] - seq[i] for i in range(9)]
kp = []
for i in range(0, len(seq)-4):
  kp.append(y[i]*y[i+3] - y[i+1]*y[i+2])
p = functools.reduce(math.gcd, kp)
a = (y[1] * libnum.modular.invmod(y[0], p)) % p
c = (seq[1] - a*seq[0])%p
print(f'p = {p}')
print(f'a = {a}')
print(f'c = {c}')

xi = seq[9]
for i in range(10):
  xi = (a*xi+c)%p
  print(xi)
  # io.sendline(str(xi).encode())
  io.sendlineafter(b'> ', str(xi).encode())

io.interactive()
```
